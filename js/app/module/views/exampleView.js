// Generated by CoffeeScript 1.3.3
(function() {

  define(["app/module/views/skeletorView", "text!app/module/templates/exampleTemplate.html", "app/module/models/lottoPeli"], function(SkeletorView, Template, LottoPeli) {
    return SkeletorView.extend({
      el: "#example-view",
      template: _.template(Template),
      events: {
        "click #play": "playButtonPressed",
        "click #reset": "resetButtonPressed",
        "change #rowsPerWeek": "settingsChanged",
        "slidechange": "settingsChanged"
      },
      settingsChanged: function() {
        return this.model.set({
          "sleepTime": this.model.get("maxSleepTime") - this.$("#slider").slider("option", "value"),
          "rowsPerWeek": this.$("#rowsPerWeek").val()
        });
      },
      resetButtonPressed: function() {
        this.model = new LottoPeli;
        return this.render();
      },
      playButtonPressed: function() {
        if (this.model.isRunning()) {
          console.log("stopping game");
          this.model.stop();
          clearTimeout(this.timeoutID);
        } else {
          console.log("starting game");
          this.model.start();
          this.runGame();
        }
        return this.render();
      },
      runGame: function() {
        var _this = this;
        if (!this.model.isRunning()) {
          return;
        }
        this.model.playWeek();
        this.timeoutID = setTimeout((function() {
          return _this.runGame();
        }), this.model.get("sleepTime"));
        return this.render();
      },
      initialize: function() {
        console.log("init example view");
        this.model = new LottoPeli;
        return this.render();
      },
      render: function() {
        this.$el.html(this.template(this.model.toJSON()));
        this.$("#slider").slider({
          max: this.model.get("maxSleepTime") - this.model.get("minSleepTime"),
          value: this.model.get("maxSleepTime") - this.model.get("sleepTime")
        });
        return this;
      }
    });
  });

}).call(this);
